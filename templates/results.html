{% extends "base.html" %}

{% block title %}Diagnosis Results - Rice Disease Expert System{% endblock %}

{% block content %}
<div class="text-center mb-5">
    <h2 class="display-5 mb-3">
        <i class="bi bi-clipboard-data text-primary"></i> {{ t('diagnosis_results') }}
    </h2>
    <p class="text-secondary">{{ t('based_on_symptoms') }}</p>
</div>

<div class="glass-panel p-4 mb-5">
    <div class="border-bottom pb-3 mb-3" style="border-color: rgba(255,255,255,0.1) !important;">
        <h5 class="mb-0 text-info">
            <i class="bi bi-list-ul"></i> {{ t('selected_symptoms') }}
        </h5>
    </div>
    <div class="row g-2">
        {% for symptom in symptoms %}
        <div class="col-md-4 col-lg-3">
            <span class="badge bg-info bg-opacity-25 text-info border border-info d-block p-2 text-wrap">
                <i class="bi bi-check-circle"></i> {{ tsym(symptom.name) }}
            </span>
        </div>
        {% endfor %}
    </div>
</div>

{% if results %}
<div class="glass-panel p-4">
    <div class="border-bottom pb-3 mb-4" style="border-color: rgba(255,255,255,0.1) !important;">
        <h5 class="mb-0 text-success">
            <i class="bi bi-graph-up"></i> Diagnosis Results
        </h5>
    </div>

    {% for result in results %}
    <div class="glass-card p-4 mb-4 {% if loop.first %}border border-success border-opacity-50{% endif %}">
        <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
                <h4 class="card-title mb-2">
                    <i class="bi bi-bug text-danger"></i>
                    {{ result.disease.name }}
                    {% if loop.first %}
                    <span class="badge bg-success ms-2" style="font-size: 0.5em;">Most Likely</span>
                    {% endif %}
                </h4>
                <p class="text-secondary mb-2">
                    <i class="bi bi-info-circle"></i> {{ result.disease.description }}
                </p>
                <small class="text-secondary opacity-75">
                    <i class="bi bi-gear"></i> {{ t('method') }}: {{ result.method|replace('-', ' ')|title }}
                </small>
            </div>
            <div class="text-end">
                <div class="display-6 fw-bold text-primary">
                    {{ "%.0f"|format(result.confidence * 100) }}%
                </div>
                <small class="text-secondary">{{ t('confidence') }}</small>
            </div>
        </div>

        <div class="mb-4">
            <div class="d-flex justify-content-between mb-1">
                <small class="text-secondary">{{ t('confidence_level') }}</small>
                <small class="text-secondary">{{ "%.1f"|format(result.confidence * 100) }}%</small>
            </div>
            <div class="progress" style="height: 10px; background-color: rgba(255,255,255,0.1);">
                <div class="progress-bar" role="progressbar"
                    style="width: {{ '%.1f'|format(result.confidence * 100) }}%; background: linear-gradient(90deg, var(--primary-color), var(--accent-color));"
                    aria-valuenow="{{ '%.1f'|format(result.confidence * 100) }}" aria-valuemin="0" aria-valuemax="100">
                </div>
            </div>
        </div>

        <div class="glass-card bg-opacity-10 p-4 mb-4" style="background: rgba(255, 255, 255, 0.02);">
            <h6 class="card-subtitle mb-2 text-warning">
                <i class="bi bi-heart-pulse"></i> {{ t('treatment_recommendations') }}
            </h6>
            <p class="card-text text-secondary mb-0">{{ result.disease.treatment }}</p>
        </div>

        <div class="">
            <a href="{{ url_for('disease.disease_detail', disease_id=result.disease.id) }}" class="btn btn-primary">
                <i class="bi bi-info-circle"></i> {{ t('view_full_details') }}
            </a>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="glass-card p-4 border border-warning border-opacity-50">
    <h4 class="text-warning mb-3">
        <i class="bi bi-exclamation-triangle"></i> {{ t('no_diagnosis_found') }}
    </h4>
    <p class="text-secondary">{{ t('no_diagnosis_msg') }}</p>
    <hr class="border-secondary opacity-25">
    <p class="mb-0">
        <a href="{{ url_for('diagnosis.diagnosis') }}" class="btn btn-primary">{{ t('try_again') }}</a>
    </p>
</div>
{% endif %}

<div class="row mt-5">
    <div class="col-12 text-center">
        <a href="{{ url_for('diagnosis.diagnosis') }}" class="btn btn-secondary btn-lg">
            <i class="bi bi-arrow-left"></i> {{ t('new_diagnosis') }}
        </a>
        <a href="{{ url_for('home.index') }}" class="btn btn-secondary btn-lg ms-3">
            <i class="bi bi-house"></i> {{ t('back_to_home') }}
        </a>
    </div>
</div>
{% endblock %}